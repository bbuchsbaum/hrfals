% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cfals_design_utils_hrfals.R
\name{create_cfals_design}
\alias{create_cfals_design}
\title{Create CFALS Design Matrices from fmrireg Objects}
\usage{
create_cfals_design(
  fmri_data_obj,
  event_model,
  hrf_basis,
  confound_obj = NULL,
  baseline_model = NULL,
  hrf_shape_duration_sec = attr(hrf_basis, "span"),
  hrf_shape_sample_res_sec = event_model$sampling_frame$TR[1],
  design_control = list(standardize_predictors = TRUE, cache_design_blocks = TRUE)
)
}
\arguments{
\item{fmri_data_obj}{An `fmri_dataset` or numeric matrix of BOLD data.}

\item{event_model}{An `event_model` object from fmrireg.}

\item{hrf_basis}{An HRF basis object with `nbasis > 1`.}

\item{confound_obj}{Optional confound matrix.}

\item{baseline_model}{Optional baseline model whose design matrix will
be projected along with `confound_obj`.}

\item{hrf_shape_duration_sec}{Duration for the HRF reconstruction grid.}

\item{hrf_shape_sample_res_sec}{Sampling resolution for the HRF grid.}

\item{design_control}{List with options controlling preprocessing of
the design matrices. The `standardize_predictors` element indicates
whether each predictor should be z-scored prior to estimation.
When `cache_design_blocks = TRUE` the lagged predictor matrices are
cached in memory if the estimated footprint is below ~32GB; otherwise
they are generated on the fly with a message to the user.}
}
\value{
List with projected design matrices, reconstruction info and
  metadata for CFALS engines. Rows of `fmri_data_obj` containing `NA`
  in any voxel are zeroed out along with the corresponding rows in the
  design matrices and `confound_obj` (if provided). The indices of these
  rows are returned as `bad_row_idx`. When predictor standardization is
  enabled the vectors `predictor_means` and `predictor_sds` contain the
  scaling factors applied to each design block.
}
\description{
This function leverages fmrireg's built-in design matrix creation and
HRF evaluation functionality to prepare inputs for CF-ALS estimation.
It uses the existing `create_fmri_design` function and adds CFALS-specific
processing.
}
